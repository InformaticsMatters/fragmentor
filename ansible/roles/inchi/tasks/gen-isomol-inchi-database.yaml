---

- name: Extract isomol smiles for this source_id with missing inchi information to isoinchfile
  command: >-
    psql -X -U {{ database[deployment].login_user }} -h {{ database[deployment].login_host }} --echo-all
     --set AUTOCOMMIT=off --set ON_ERROR_STOP=on
     -c "\COPY (SELECT iso.smiles FROM isomol iso
                 WHERE iso.inchis IS NULL)
                    TO '{{ fragpath }}/fragment/{{ isoinchifile }}'"
    {{ database[deployment].db }}
  environment:
    PGPASSWORD: "{{ database[deployment].login_password }}"

#
# python -m frag.network.scripts.generate_inchi -i $FRAGPATH/fragment/$FRAGNODEFILE -o $FRAGPATH/fragment/$INCHITAB -n -s -node
#

- name: Run python generate_inchi
  script: generate_inchi.py -i {{ fragpath }}/fragment/{{ isoinchifile }} -o {{ fragpath }}/fragment/{{ isoinchitab }} -n

